<ion-view>
  <ion-nav-title>{{stop ? (stop.Name + ' (' + stop.StopId + ')' ) : 'Loading...'}}</ion-nav-title>
  <ion-nav-buttons side="secondary">
    <button id="like" ng-class="{'button button-icon icon ion-ios-heart': liked, 'button button-icon icon ion-ios-heart-outline': !liked}"
                      ng-click="liked= !liked; toggleHeart(liked)">
    </button>
  </ion-nav-buttons>
  <ion-content overflow-scroll="true">
    <ion-refresher pulling-text="Pull to refresh..." on-refresh="refresh()"></ion-refresher>
    <!-- For every route, group it and allow it to be toggled open or closed -->
    <div class="item item-divider item-positive center" ng-if="stop">
      Tap a route to view more departures
    </div>
    <ion-list ng-repeat="routeDepartures in departuresByRoute">
      <ion-item ng-click="toggleRouteDropdown(routeDepartures.RouteId)"
                      ng-class="{active: isRouteDropdownShown({{routeDepartures.RouteId}})}"
                      style="background-color: #{{routeList[routeDepartures.RouteId].Color}};">
        <div class="row item-text-wrap white">
          <div class="col route-shortname">
            {{routeList[routeDepartures.RouteId].RouteAbbreviation}}
          </div>
          <div class="col-50">
            {{routeDepartures.Departures[0].Trip.InternetServiceDesc}}
          </div>
          <div class="col-33 text-right">
            <span>
              {{routeDepartures.Departures[0].Times.eExact}}
            </span>
            <p style="color: white">
              ({{routeDepartures.Departures[0].Times.eRelativeNoPrefix}})
            </p>
          </div>
        </div>
      </ion-item>
      <!-- When a route has been expanded, show its departures -->
      <ion-item class="item-accordion"
                      ng-repeat="departure in routeDepartures.Departures"
                      ng-show="isRouteDropdownShown({{routeDepartures.RouteId}})"
                      href="#/app/routes/{{routeDepartures.RouteId}}">
          <div class="item-text-wrap bold center">
            {{departure.Trip.InternetServiceDesc}}
          </div>
          <div class="row item-text-wrap">
            <div class="col center">
              <b>Scheduled</b>
            </div>
            <div class="col center">
              <b>Estimated</b>
            </div>
          </div>
          <div class="row item-text-wrap">
            <div class="col">
              <center class="departure-padding">
                {{departure.Times.sExact}}
              </center>
              <center>
                ({{departure.Times.sRelative}})
              </center>
            </div>
            <div class="col">
              <center class="departure-padding">
                {{departure.Times.eExact}}
              </center>
              <center>
                ({{departure.Times.eRelative}})
              </center>
            </div>
          </div>
      </ion-item>
    </ion-list>
    <div ng-if="!departuresByRoute.length && stop">
      <ion-item class="item item-assertive center">
        {{stop.Name}} has no departures for at least the next 3 hours.
      </ion-item>
    </div>
    <div>
      <p class="disclaimer">
        <b>Disclaimer:</b><br>
        Real-time data is an estimate and may be incorrect or unavailable.<br>
        Please continue to reference official schedules as necessary.
      </p>
    </div>
  </ion-content>
  <ion-footer-bar class="bar-positive">
      <button class="button icon-center ion-ios-location title" ng-click="setCoordinates()" ng-if="stop">
        Find on map
      </button>
  </ion-footer-bar>
</ion-view>
